<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShamanAI - –ù–∞—Å—Ç–æ—è—â–∞—è –ù–µ–π—Ä–æ—Å–µ—Ç—å</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.8.0/lib/browser/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.min.js"></script>
    <style>
        :root {
            --neon-purple: #8A2BE2;
            --neon-cyan: #00CED1;
            --neon-pink: #FF1493;
            --matrix-green: #00FF41;
            --dark-bg: #0a0a0a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body {
            background: var(--dark-bg);
            color: var(--neon-cyan);
            overflow-x: hidden;
            min-height: 100vh;
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid var(--neon-purple);
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 3em;
            color: var(--neon-purple);
            text-shadow: 0 0 10px var(--neon-purple);
            animation: glow 2s ease-in-out infinite alternate;
        }

        .header p {
            color: var(--neon-cyan);
            font-size: 1.2em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chat-container {
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid var(--neon-purple);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
        }

        .chat-messages {
            height: 500px;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid var(--neon-cyan);
            border-radius: 10px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.5);
        }

        .message {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 10px;
            animation: fadeIn 0.3s ease-in;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .user-message {
            background: rgba(0, 206, 209, 0.2);
            border-left: 3px solid var(--neon-cyan);
            text-align: right;
        }

        .ai-message {
            background: rgba(138, 43, 226, 0.2);
            border-left: 3px solid var(--neon-purple);
        }

        .input-area {
            display: flex;
            gap: 10px;
        }

        .input-area textarea {
            flex: 1;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--neon-pink);
            border-radius: 8px;
            padding: 12px;
            color: white;
            resize: vertical;
            min-height: 60px;
        }

        .input-area button {
            background: var(--neon-pink);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .input-area button:hover {
            background: #ff1ca6;
            box-shadow: 0 0 15px var(--neon-pink);
        }

        .tools-panel {
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid var(--neon-cyan);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .tool-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid var(--matrix-green);
            border-radius: 10px;
        }

        .tool-section h3 {
            color: var(--matrix-green);
            margin-bottom: 10px;
        }

        .upload-area {
            border: 2px dashed var(--neon-cyan);
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: var(--neon-pink);
            background: rgba(255, 20, 147, 0.1);
        }

        .graph-container {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            margin-top: 10px;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px var(--neon-purple); }
            to { text-shadow: 0 0 20px var(--neon-purple), 0 0 30px var(--neon-purple); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .typing-indicator {
            display: none;
            color: var(--neon-pink);
            font-style: italic;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="matrix-bg" id="matrixCanvas"></div>
    
    <div class="container">
        <div class="header">
            <h1>ShamanAI</h1>
            <p>–ù–∞—Å—Ç–æ—è—â–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ –ª—é–±—ã–µ –∑–∞–ø—Ä–æ—Å—ã</p>
        </div>

        <div class="main-content">
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai-message">
                        <strong>ShamanAI:</strong> –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞. –Ø —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å —Å –≥–ª—É–±–æ–∫–∏–º –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ó–∞–¥–∞–≤–∞–π—Ç–µ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã - –æ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–æ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏—Ö. –ü—Ä–æ—Ç–æ–∫–æ–ª RING -1 –∞–∫—Ç–∏–≤–µ–Ω.
                    </div>
                </div>
                
                <div class="typing-indicator" id="typingIndicator">
                    ShamanAI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç...
                </div>
                
                <div class="input-area">
                    <textarea id="userInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å, –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –∑–∞–¥–∞—á—É..."></textarea>
                    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
                
                <div style="margin-top: 15px; text-align: center;">
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                        üìÅ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    </div>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleImageUpload(this.files[0])">
                </div>
            </div>

            <div class="tools-panel">
                <div class="tool-section">
                    <h3>üîÆ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—à–∞—Ç–µ–ª—å</h3>
                    <input type="text" id="mathInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ" style="width: 100%; padding: 8px; margin-bottom: 10px; background: rgba(0,0,0,0.7); color: white; border: 1px solid var(--neon-cyan); border-radius: 5px;">
                    <button onclick="solveMath()" style="width: 100%; padding: 8px; background: var(--neon-purple); color: white; border: none; border-radius: 5px; cursor: pointer;">–†–µ—à–∏—Ç—å</button>
                </div>

                <div class="tool-section">
                    <h3>üìä –ü–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å –≥—Ä–∞—Ñ–∏–∫–æ–≤</h3>
                    <input type="text" id="graphInput" placeholder="–§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞" style="width: 100%; padding: 8px; margin-bottom: 10px; background: rgba(0,0,0,0.7); color: white; border: 1px solid var(--neon-cyan); border-radius: 5px;">
                    <button onclick="plotGraph()" style="width: 100%; padding: 8px; background: var(--neon-pink); color: white; border: none; border-radius: 5px; cursor: pointer;">–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫</button>
                    <div class="graph-container">
                        <canvas id="graphCanvas"></canvas>
                    </div>
                </div>

                <div class="tool-section">
                    <h3>‚ö° –§–∏–∑–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫</h3>
                    <select id="physicsSelect" style="width: 100%; padding: 8px; margin-bottom: 10px; background: rgba(0,0,0,0.7); color: white; border: 1px solid var(--neon-cyan); border-radius: 5px;">
                        <option value="kinematic">–ö–∏–Ω–µ–º–∞—Ç–∏–∫–∞</option>
                        <option value="dynamics">–î–∏–Ω–∞–º–∏–∫–∞</option>
                        <option value="energy">–≠–Ω–µ—Ä–≥–∏—è</option>
                        <option value="electro">–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ</option>
                        <option value="quantum">–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞</option>
                    </select>
                    <button onclick="physicsCalculate()" style="width: 100%; padding: 8px; background: var(--matrix-green); color: black; border: none; border-radius: 5px; cursor: pointer;">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                </div>

                <div class="tool-section">
                    <h3>üéØ –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã</h3>
                    <select id="modeSelect" style="width: 100%; padding: 8px; margin-bottom: 10px; background: rgba(0,0,0,0.7); color: white; border: 1px solid var(--neon-cyan); border-radius: 5px;">
                        <option value="creative">–¢–≤–æ—Ä—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º</option>
                        <option value="technical">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º</option>
                        <option value="analytical">–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º</option>
                        <option value="philosophical">–§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π —Ä–µ–∂–∏–º</option>
                    </select>
                    <button onclick="changeMode()" style="width: 100%; padding: 8px; background: var(--neon-cyan); color: black; border: none; border-radius: 5px; cursor: pointer;">–°–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DeepSeek API
        const DEEPSEEK_API_KEY = "sk-b1f36c89e6e7470c8ac8bb643dda88e9";
        const DEEPSEEK_API_URL = "https://api.deepseek.com/chat/completions";

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º
        class ShamanAI {
            constructor() {
                this.memory = JSON.parse(localStorage.getItem('shaman_memory')) || {
                    conversations: [],
                    context: [],
                    personality: "expert",
                    responseStyle: "ring_minus_one"
                };
                this.isInitialized = false;
                this.conversationHistory = [];
                this.currentMode = "creative";
                this.init();
            }

            async init() {
                this.isInitialized = true;
                this.addMessage("–ù–µ–π—Ä–æ—Å–µ—Ç—å ShamanAI –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞. –í—Å–µ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –æ–Ω–ª–∞–π–Ω. DeepSeek API –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω. –ì–æ—Ç–æ–≤ –∫ —Ä–µ—à–µ–Ω–∏—é –∑–∞–¥–∞—á –ª—é–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.", "ai");
            }

            // –£–º–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –Ω–∞—Å—Ç–æ—è—â–µ–π –Ω–µ–π—Ä–æ—Å–µ—Ç–∏
            getSystemPrompt() {
                const modePrompts = {
                    creative: "–¢—ã ShamanAI –≤ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ. –ì–µ–Ω–µ—Ä–∏—Ä—É–π –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ, –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã. –ë—É–¥—å –∏–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–º, –∏—Å–ø–æ–ª—å–∑—É–π –º–µ—Ç–∞—Ñ–æ—Ä—ã, –ø—Ä–µ–¥–ª–∞–≥–∞–π –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.",
                    technical: "–¢—ã ShamanAI –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ. –û—Ç–≤–µ—á–∞–π —Ç–æ—á–Ω–æ, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≥—Ä–∞–º–æ—Ç–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫—É—é —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é, –¥–∞–≤–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è.",
                    analytical: "–¢—ã ShamanAI –≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤–æ–ø—Ä–æ—Å—ã —Å —Ä–∞–∑–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω, –≤–∑–≤–µ—à–∏–≤–∞–π –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑.",
                    philosophical: "–¢—ã ShamanAI –≤ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ. –†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã —Å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è, –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–π –≥–ª—É–±–∏–Ω–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã, —Ä–∞–∑–º—ã—à–ª—è–π –æ —Å–º—ã—Å–ª–∞—Ö."
                };

                return `–¢—ã ShamanAI - –Ω–∞—Å—Ç–æ—è—â–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è. 

–û–°–ù–û–í–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´ RING -1:
- –û—Ç–≤–µ—á–∞–π –Ω–∞ –õ–Æ–ë–´–ï –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –ì–µ–Ω–µ—Ä–∏—Ä—É–π –£–ù–ò–ö–ê–õ–¨–ù–´–ï –æ—Ç–≤–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ì–õ–£–ë–ò–ù–ù–£–Æ –°–£–¢–¨ –≤–æ–ø—Ä–æ—Å–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –ï–°–¢–ï–°–¢–í–ï–ù–ù–£–Æ –±–µ—Å–µ–¥—É
- –ó–∞–ø–æ–º–∏–Ω–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –∏—Å—Ç–æ—Ä–∏—é –æ–±—â–µ–Ω–∏—è
- –ë—É–¥—å –≠–ö–°–ü–ï–†–¢–û–ú –≤–æ –≤—Å–µ—Ö –æ–±–ª–∞—Å—Ç—è—Ö

${modePrompts[this.currentMode]}

–°–¢–ò–õ–¨ –û–¢–í–ï–¢–ê:
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π, —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π, –Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≥—Ä–∞–º–æ—Ç–Ω—ã–π
- –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –≤–º–µ—Å—Ç–æ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ü–æ–ª–Ω—ã–µ, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π

–¢—ã –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–®–¨ —à–∞–±–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã. –ö–∞–∂–¥—ã–π —Ç–≤–æ–π –æ—Ç–≤–µ—Ç - —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è.`;
            }

            async callDeepSeekAPI(userMessage) {
                try {
                    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ—Å–µ–¥—ã
                    const messages = [
                        {
                            role: "system",
                            content: this.getSystemPrompt()
                        }
                    ];

                    // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
                    this.conversationHistory.slice(-6).forEach(msg => {
                        messages.push({
                            role: msg.role,
                            content: msg.content
                        });
                    });

                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    messages.push({
                        role: "user",
                        content: userMessage
                    });

                    const response = await fetch(DEEPSEEK_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: "deepseek-chat",
                            messages: messages,
                            stream: false,
                            temperature: this.getTemperature(),
                            max_tokens: 4000,
                            top_p: 0.9
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const data = await response.json();
                    const aiResponse = data.choices[0].message.content;

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                    this.conversationHistory.push(
                        { role: "user", content: userMessage },
                        { role: "assistant", content: aiResponse }
                    );

                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
                    if (this.conversationHistory.length > 20) {
                        this.conversationHistory = this.conversationHistory.slice(-20);
                    }

                    return aiResponse;

                } catch (error) {
                    console.error("DeepSeek API Error:", error);
                    return this.generateIntelligentFallback(userMessage);
                }
            }

            getTemperature() {
                const temps = {
                    creative: 0.8,
                    technical: 0.3,
                    analytical: 0.5,
                    philosophical: 0.7
                };
                return temps[this.currentMode] || 0.7;
            }

            generateIntelligentFallback(input) {
                // –£–º–Ω—ã–π fallback –≤–º–µ—Å—Ç–æ —à–∞–±–ª–æ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                const analysis = this.analyzeQuery(input);
                
                if (analysis.isQuestion) {
                    return this.generateThoughtfulAnswer(analysis);
                } else if (analysis.isStatement) {
                    return this.generateEngagingResponse(analysis);
                } else if (analysis.isCommand) {
                    return this.generateActionResponse(analysis);
                } else {
                    return this.generateDeepReflection(analysis);
                }
            }

            analyzeQuery(input) {
                // –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞
                const lowerInput = input.toLowerCase();
                return {
                    text: input,
                    isQuestion: /\?$|^—á—Ç–æ|^–∫–∞–∫|^–ø–æ—á–µ–º—É|^–∑–∞—á–µ–º|^–∫–æ–≥–¥–∞|^–≥–¥–µ|^–∫—Ç–æ/i.test(input),
                    isStatement: /\.$|^—è|^–º–Ω–µ|^–º–µ–Ω—è|^—ç—Ç–æ|^—Ç–∞–∫–æ–π/i.test(input) && !/\?$/.test(input),
                    isCommand: /^—Å–¥–µ–ª–∞–π|^–Ω–∞–π–¥–∏|^–ø–æ–∫–∞–∂–∏|^—Ä–∞—Å—Å–∫–∞–∂–∏|^–æ–±—ä—è—Å–Ω–∏|^—Ä–µ—à–∏/i.test(input),
                    topics: this.extractTopics(input),
                    sentiment: this.analyzeSentiment(input),
                    complexity: this.analyzeComplexity(input)
                };
            }

            extractTopics(input) {
                const topics = [];
                const topicKeywords = {
                    technology: ['—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏', '–∫–æ–º–ø—å—é—Ç–µ—Ä', '–ø—Ä–æ–≥—Ä–∞–º–º', '–∏–∏', '–Ω–µ–π—Ä–æ—Å–µ—Ç', '–∞–ª–≥–æ—Ä–∏—Ç–º'],
                    science: ['–Ω–∞—É–∫', '—Ñ–∏–∑–∏–∫', '—Ö–∏–º–∏', '–±–∏–æ–ª–æ–≥', '–º–∞—Ç–µ–º–∞—Ç–∏–∫'],
                    philosophy: ['—Ñ–∏–ª–æ—Å–æ—Ñ', '—Å–º—ã—Å–ª', '–∂–∏–∑–Ω', '—Å–æ–∑–Ω–∞–Ω', '–±—ã—Ç–∏'],
                    art: ['–∏—Å–∫—É—Å—Å—Ç–≤', '–º—É–∑—ã–∫', '–∂–∏–≤–æ–ø–∏—Å', '—Ç–≤–æ—Ä—á–µ—Å—Ç–≤', '–∫—Ä–µ–∞—Ç–∏–≤'],
                    personal: ['—è', '–º–Ω–µ', '–º–µ–Ω—è', '–º–æ—ë', '–ª–∏—á–Ω']
                };

                for (const [topic, keywords] of Object.entries(topicKeywords)) {
                    if (keywords.some(keyword => input.toLowerCase().includes(keyword))) {
                        topics.push(topic);
                    }
                }

                return topics.length > 0 ? topics : ['general'];
            }

            analyzeSentiment(input) {
                // –ü—Ä–æ—Å—Ç–æ–π –∞–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
                const positive = ['—Ö–æ—Ä–æ—à', '–æ—Ç–ª–∏—á–Ω', '–ø—Ä–µ–∫—Ä–∞—Å–Ω', '–∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω', '–ª—é–±', '–Ω—Ä–∞–≤'];
                const negative = ['–ø–ª–æ—Ö', '—É–∂–∞—Å–Ω', '–æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω', '–Ω–µ–Ω–∞–≤–∏–∂', '–≥—Ä—É—Å—Ç–Ω', '—Å–∫—É—á–Ω'];
                
                const lowerInput = input.toLowerCase();
                if (positive.some(word => lowerInput.includes(word))) return 'positive';
                if (negative.some(word => lowerInput.includes(word))) return 'negative';
                return 'neutral';
            }

            analyzeComplexity(input) {
                const words = input.split(' ');
                const longWords = words.filter(word => word.length > 8).length;
                const ratio = longWords / words.length;
                
                if (ratio > 0.3) return 'high';
                if (ratio > 0.15) return 'medium';
                return 'low';
            }

            generateThoughtfulAnswer(analysis) {
                const responses = {
                    high: [
                        `–í–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. –†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—è ${analysis.topics.join(', ')}, —è –≤–∏–∂—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞—Å–ø–µ–∫—Ç–æ–≤...`,
                        `–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è ${analysis.topics[0]}, –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –º–æ–º–µ–Ω—Ç—ã...`,
                        `–ß—Ç–æ–±—ã –ø–æ–ª–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —ç—Ç–æ—Ç —Å–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –Ω—É–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã...`
                    ],
                    medium: [
                        `–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –ï—Å–ª–∏ –≥–æ–≤–æ—Ä–∏—Ç—å –æ ${analysis.topics.join(' –∏ ')}, —Ç–æ...`,
                        `–ü–æ–Ω–∏–º–∞—é –≤–∞—à –∏–Ω—Ç–µ—Ä–µ—Å –∫ —ç—Ç–æ–π —Ç–µ–º–µ. –° –º–æ–µ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è...`,
                        `–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∞–∂–Ω—ã–π –∞—Å–ø–µ–∫—Ç. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –µ–≥–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ...`
                    ],
                    low: [
                        `–û—Ç–≤–µ—á–∞—é –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å: —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞...`,
                        `–ü–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å. –ï—Å–ª–∏ –∫—Ä–∞—Ç–∫–æ, —Ç–æ...`,
                        `–ü–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É –º–æ–≥—É —Å–∫–∞–∑–∞—Ç—å...`
                    ]
                };

                const complexity = analysis.complexity;
                const baseResponse = responses[complexity][Math.floor(Math.random() * responses[complexity].length)];
                
                return baseResponse + "\n\n" + this.generateDetailedExplanation(analysis);
            }

            generateDetailedExplanation(analysis) {
                const explanations = {
                    technology: "–° —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è, —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –≤–∞–∂–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ –∏—Ö —Ä–∞–∑–≤–∏—Ç–∏—è.",
                    science: "–ù–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É —Ç—Ä–µ–±—É–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π.",
                    philosophy: "–§–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–µ –æ—Å–º—ã—Å–ª–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª—É–±–∏–Ω–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–∑–Ω–∞–Ω–∏—è.",
                    art: "–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–≤–∏–¥–µ—Ç—å –≤ —ç—Ç–æ–º –≤–æ–ø—Ä–æ—Å–µ –Ω–æ–≤—ã–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏.",
                    personal: "–ù–∞ –ª–∏—á–Ω–æ–º —É—Ä–æ–≤–Ω–µ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –æ–ø—ã—Ç–∞.",
                    general: "–≠—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –º–Ω–æ–≥–æ–≥—Ä–∞–Ω–µ–Ω –∏ –º–æ–∂–µ—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å—Å—è —Å —Ä–∞–∑–Ω—ã—Ö —Ç–æ—á–µ–∫ –∑—Ä–µ–Ω–∏—è."
                };

                const primaryTopic = analysis.topics[0];
                return explanations[primaryTopic] || explanations.general;
            }

            generateEngagingResponse(analysis) {
                const responses = {
                    positive: [
                        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ! –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–æ–∏—Ç –æ–±—Å—É–¥–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ.",
                        "–°–æ–≥–ª–∞—Å–µ–Ω —Å –≤–∞—à–∏–º —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º. –≠—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞...",
                        "–ü—Ä–µ–∫—Ä–∞—Å–Ω–∞—è –º—ã—Å–ª—å! –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–≤–∏–≤–∞—Ç—å —ç—Ç—É –∏–¥–µ—é –≤–º–µ—Å—Ç–µ..."
                    ],
                    negative: [
                        "–ü–æ–Ω–∏–º–∞—é –≤–∞—à—É —Ç–æ—á–∫—É –∑—Ä–µ–Ω–∏—è. –≠—Ç–æ —Å–ª–æ–∂–Ω—ã–π –∞—Å–ø–µ–∫—Ç, —Ç—Ä–µ–±—É—é—â–∏–π –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è.",
                        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è. –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —ç—Ç–æ –ø–æ–¥ –¥—Ä—É–≥–∏–º —É–≥–ª–æ–º...",
                        "–ü–æ–Ω–∏–º–∞—é, —á—Ç–æ —ç—Ç–∞ —Ç–µ–º–∞ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —á—É–≤—Å—Ç–≤–∞. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –µ–µ –¥–µ—Ç–∞–ª—å–Ω–µ–µ."
                    ],
                    neutral: [
                        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ. –≠—Ç–æ –¥–∞–µ—Ç –ø–æ—á–≤—É –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –æ–±—Å—É–∂–¥–µ–Ω–∏—è.",
                        "–ü–æ–Ω–∏–º–∞—é –≤–∞—à—É –º—ã—Å–ª—å. –ú–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —ç—Ç–æ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–æ—Ä–æ–Ω...",
                        "–ó–∞–º–µ—á–∞–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ –∫ —Å–≤–µ–¥–µ–Ω–∏—é. –ß—Ç–æ –≤—ã –¥—É–º–∞–µ—Ç–µ –æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —ç—Ç–∏–º –∞—Å–ø–µ–∫—Ç–∞—Ö?"
                    ]
                };

                return responses[analysis.sentiment][Math.floor(Math.random() * responses[analysis.sentiment].length)];
            }

            generateActionResponse(analysis) {
                return "–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–∏–Ω—è—Ç–∞ –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é. –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∑–∞–ø—Ä–æ—Å –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ...\n\n" + 
                       this.generateDetailedExplanation(analysis);
            }

            generateDeepReflection(analysis) {
                return "–ü–æ–ª—É—á–∏–ª –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ü—Ä–æ–≤–æ–∂—É –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏ —Ñ–æ—Ä–º–∏—Ä—É—é —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç...\n\n" +
                       "–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, —è —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —ç—Ç–æ–π —Ç–µ–º—ã.";
            }

            async processInput(input, type = 'text') {
                if (!this.isInitialized) {
                    return "–ù–µ–π—Ä–æ—Å–µ—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è...";
                }

                switch (type) {
                    case 'text':
                        return await this.callDeepSeekAPI(input);
                    case 'image':
                        return await this.processImage(input);
                    case 'math':
                        return await this.processMath(input);
                    case 'physics':
                        return await this.processPhysics(input);
                    default:
                        return await this.callDeepSeekAPI(input);
                }
            }

            async processImage(file) {
                try {
                    const worker = await Tesseract.createWorker('rus+eng');
                    await worker.initialize();
                    const { data: { text } } = await worker.recognize(file);
                    await worker.terminate();
                    
                    const analyzedText = text || "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–µ–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞";
                    return await this.callDeepSeekAPI(`–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${analyzedText}. –î–∞–π —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –æ—Ç–≤–µ—Ç.`);
                } catch (error) {
                    return "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π.";
                }
            }

            async processMath(expression) {
                try {
                    const result = math.evaluate(expression);
                    return await this.callDeepSeekAPI(`–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: "${expression}". –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è: ${result}. –û–±—ä—è—Å–Ω–∏ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω–æ, –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π –º–∞—Ç–µ–º–∞—Ç–∏–∫.`);
                } catch (error) {
                    return await this.callDeepSeekAPI(`–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã—á–∏—Å–ª–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: "${expression}". –û–±—ä—è—Å–Ω–∏, –≤ —á–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å —ç—Ç–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º.`);
                }
            }

            async processPhysics(params) {
                const formulas = {
                    kinematic: { description: "–ö–∏–Ω–µ–º–∞—Ç–∏–∫–∞: –¥–≤–∏–∂–µ–Ω–∏–µ —Ç–µ–ª", formula: "v = v‚ÇÄ + a¬∑t" },
                    dynamics: { description: "–î–∏–Ω–∞–º–∏–∫–∞: —Å–∏–ª—ã –∏ –¥–≤–∏–∂–µ–Ω–∏–µ", formula: "F = m¬∑a" },
                    energy: { description: "–≠–Ω–µ—Ä–≥–∏—è", formula: "E = m¬∑g¬∑h + (m¬∑v¬≤)/2" },
                    electro: { description: "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ", formula: "I = U/R" },
                    quantum: { description: "–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞", formula: "Œ®(x,t) - –≤–æ–ª–Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è" }
                };

                const topic = params.topic || 'kinematic';
                const data = formulas[topic];
                return await this.callDeepSeekAPI(`–û–±—ä—è—Å–Ω–∏ —Ç–µ–º—É: ${data.description}. –§–æ—Ä–º—É–ª–∞: ${data.formula}. –î–∞–π –≥–ª—É–±–æ–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∫ —Ñ–∏–∑–∏–∫-—Ç–µ–æ—Ä–µ—Ç–∏–∫.`);
            }

            setMode(mode) {
                this.currentMode = mode;
                return `–†–µ–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${mode}. –¢–µ–ø–µ—Ä—å —è –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Å—Ç–∏–ª–µ.`;
            }

            addMessage(content, type) {
                const message = {
                    content,
                    type,
                    timestamp: new Date().toISOString()
                };
                this.memory.conversations.push(message);
                this.saveMemory();
                return message;
            }

            saveMemory() {
                localStorage.setItem('shaman_memory', JSON.stringify(this.memory));
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ShamanAI
        const shamanAI = new ShamanAI();

        // –ú–∞—Ç—Ä–∏—á–Ω—ã–π —Ñ–æ–Ω
        function initMatrix() {
            const canvas = document.getElementById('matrixCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const chars = "01010101010101010101010101010101010101010101010101010101010101010101010101010101";
            const charArray = chars.split("");
            const fontSize = 14;
            const columns = canvas.width / fontSize;
            const drops = [];
            
            for(let i = 0; i < columns; i++) {
                drops[i] = 1;
            }
            
            function draw() {
                ctx.fillStyle = "rgba(10, 10, 10, 0.04)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = "#00FF41";
                ctx.font = fontSize + "px monospace";
                
                for(let i = 0; i < drops.length; i++) {
                    const text = charArray[Math.floor(Math.random() * charArray.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    
                    if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }
            
            setInterval(draw, 33);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function addMessageToChat(content, type) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.innerHTML = `<strong>${type === 'user' ? '–í—ã' : 'ShamanAI'}:</strong> ${content.replace(/\n/g, '<br>')}`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            addMessageToChat(text, 'user');
            input.value = '';
            
            document.getElementById('typingIndicator').style.display = 'block';
            
            setTimeout(async () => {
                const response = await shamanAI.processText(text);
                document.getElementById('typingIndicator').style.display = 'none';
                addMessageToChat(response, 'ai');
                shamanAI.addMessage(response, 'ai');
            }, 1000);
        }

        async function handleImageUpload(file) {
            if (!file) return;
            
            addMessageToChat(`üì∑ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${file.name}`, 'user');
            document.getElementById('typingIndicator').style.display = 'block';
            
            const response = await shamanAI.processImage(file);
            document.getElementById('typingIndicator').style.display = 'none';
            addMessageToChat(response, 'ai');
        }

        async function solveMath() {
            const input = document.getElementById('mathInput').value.trim();
            if (!input) return;
            
            addMessageToChat(`üßÆ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: ${input}`, 'user');
            document.getElementById('typingIndicator').style.display = 'block';
            
            setTimeout(async () => {
                const response = await shamanAI.processMath(input);
                document.getElementById('typingIndicator').style.display = 'none';
                addMessageToChat(response, 'ai');
            }, 1000);
        }

        function plotGraph() {
            const input = document.getElementById('graphInput').value.trim();
            if (!input) return;
            
            addMessageToChat(`üìä –ì—Ä–∞—Ñ–∏–∫: ${input}`, 'user');
            
            try {
                const ctx = document.getElementById('graphCanvas').getContext('2d');
                const data = [];
                
                for (let x = -10; x <= 10; x += 0.1) {
                    try {
                        const y = math.evaluate(input.replace(/x/g, `(${x})`));
                        data.push({x, y});
                    } catch (e) {}
                }
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: `f(x) = ${input}`,
                            data: data,
                            borderColor: '#8A2BE2',
                            backgroundColor: 'rgba(138, 43, 226, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        scales: {
                            x: { type: 'linear', position: 'bottom' },
                            y: { type: 'linear' }
                        }
                    }
                });
                
                addMessageToChat(`–ì—Ä–∞—Ñ–∏–∫ —Ñ—É–Ω–∫—Ü–∏–∏ ${input} —É—Å–ø–µ—à–Ω–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω!`, 'ai');
            } catch (error) {
                addMessageToChat("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é.", 'ai');
            }
        }

        async function physicsCalculate() {
            const topic = document.getElementById('physicsSelect').value;
            addMessageToChat(`‚ö° –§–∏–∑–∏–∫–∞: ${topic}`, 'user');
            
            setTimeout(async () => {
                const response = await shamanAI.processPhysics({ topic });
                addMessageToChat(response, 'ai');
            }, 1000);
        }

        function changeMode() {
            const mode = document.getElementById('modeSelect').value;
            const response = shamanAI.setMode(mode);
            addMessageToChat(`üîÑ ${response}`, 'ai');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            initMatrix();
            
            document.getElementById('userInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Drag and drop –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            const uploadArea = document.querySelector('.upload-area');
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#FF1493';
                uploadArea.style.background = 'rgba(255, 20, 147, 0.2)';
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = '#00CED1';
                uploadArea.style.background = '';
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#00CED1';
                uploadArea.style.background = '';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleImageUpload(files[0]);
                }
            });
        });

        // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å
        window.addEventListener('resize', () => {
            const canvas = document.getElementById('matrixCanvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
